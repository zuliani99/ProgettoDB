conn = engine.connect()

result = conn.execute("SELECT * FROM role WHERE name = 'Admin' OR name = 'Customers'").fetchone()
if result is None:
	ins = role.insert()
	conn.execute(ins, [
		{"name": "Admin"}, {"name": "Customer"}
	])

result = conn.execute("SELECT * FROM users WHERE 'username' = 'Administrator2' AND 'email' = 'administrator2@airport.com'").fetchone()
if result is None:
	trans = conn.begin()
	try:
		conn.execute("INSERT INTO users('username', 'email', 'image_file', 'password', 'admin') VALUES ('Administrator2', 'administrator2@airport.com', 'default.jpg', ?, 1)", bcrypt.generate_password_hash("adminpassword123").decode('utf-8'))
		trans.commit()
	except:
		trans.rollback()
	result = conn.execute(select([users.c.id]).where(users.c.username == "Administrator2"))
	row = result.fetchone()
	ins = usersrole.insert()
	conn.execute(ins, [
		{"user_id": row[0], "role_id": 1}
	])

conn.close()


usersrole = Table('usersrole', metadata,
	Column('id', Integer, primary_key=True),
	Column('user_id', Integer, ForeignKey('users.id', ondelete='CASCADE'), nullable=False),
	Column('role_id', Integer, ForeignKey('role.id', ondelete='CASCADE'), nullable=False)
)

role = Table ('role', metadata,
	Column('id', Integer, primary_key=True),
	Column('name', String(20), unique=True)
)


